#!/bin/bash

set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$ROOT_DIR"

PYTHON_BIN="${PYTHON_BIN:-python3}"
CLI_SCRIPT="$ROOT_DIR/scripts/ai_proxy_cli.py"
BASH_FALLBACK="$ROOT_DIR/scripts/setup_wizard.sh"

ARGS=("$@")
if [ "${#ARGS[@]}" -eq 0 ]; then
  ARGS=("wizard")
fi

if command -v "$PYTHON_BIN" >/dev/null 2>&1; then
  if "$PYTHON_BIN" -c "import click, rich" >/dev/null 2>&1; then
    exec "$PYTHON_BIN" "$CLI_SCRIPT" "${ARGS[@]}"
  fi
fi

if [ -x "$BASH_FALLBACK" ]; then
  echo "提示: 未检测到 click/rich，已自动切换到 bash 向导。"
  echo "如需使用 Python CLI：python3 -m pip install -r requirements-cli.txt"
  exec "$BASH_FALLBACK"
fi

echo "错误: 找不到 Python CLI 或 bash fallback。"
exit 1
